<aside class="toc-sidebar">
  <div class="toc-container">
    <h3 class="toc-title">Contents</h3>
    <nav class="toc-nav" id="toc-nav">
      <!-- TOC will be generated by JavaScript -->
    </nav>
  </div>
</aside>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const content = document.querySelector('.post-content');
  const tocNav = document.getElementById('toc-nav');

  if (!content || !tocNav) return;

  const headings = content.querySelectorAll('h2, h3');

  if (headings.length === 0) {
    tocNav.parentElement.style.display = 'none';
    return;
  }

  const ul = document.createElement('ul');

  headings.forEach((heading, index) => {
    // Add ID to heading if not exists
    if (!heading.id) {
      heading.id = 'heading-' + index;
    }

    const li = document.createElement('li');
    li.className = heading.tagName.toLowerCase();

    const a = document.createElement('a');
    a.href = '#' + heading.id;
    a.textContent = heading.textContent;

    li.appendChild(a);
    ul.appendChild(li);
  });

  tocNav.appendChild(ul);

  // Highlight current section on scroll
  const observerOptions = {
    rootMargin: '-80px 0px -80% 0px'
  };

  const observer = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
      const id = entry.target.id;
      const tocLink = tocNav.querySelector(`a[href="#${id}"]`);

      if (entry.isIntersecting) {
        tocNav.querySelectorAll('a').forEach(a => a.classList.remove('active'));
        if (tocLink) tocLink.classList.add('active');
      }
    });
  }, observerOptions);

  headings.forEach(heading => observer.observe(heading));
});
</script>
